import _,{Fragment as Y,createContext as O,useContext as k,useMemo as E,useReducer as Z,useRef as G}from"react";import{render as D,Features as V,forwardRefWithAs as v}from"../../utils/render.js";import{useId as q}from"../../hooks/use-id.js";import{match as J}from"../../utils/match.js";import{Keys as f}from"../../components/keyboard.js";import{focusIn as S,Focus as m,sortByDomNode as Q}from"../../utils/focus-management.js";import{useIsoMorphicEffect as j}from"../../hooks/use-iso-morphic-effect.js";import{useSyncRefs as F}from"../../hooks/use-sync-refs.js";import{useResolveButtonType as ee}from"../../hooks/use-resolve-button-type.js";import{useLatestValue as W}from"../../hooks/use-latest-value.js";import{FocusSentinel as te}from"../../internal/focus-sentinel.js";import{useEvent as U}from"../../hooks/use-event.js";var re=(n=>(n[n.SetSelectedIndex=0]="SetSelectedIndex",n[n.RegisterTab=1]="RegisterTab",n[n.UnregisterTab=2]="UnregisterTab",n[n.RegisterPanel=3]="RegisterPanel",n[n.UnregisterPanel=4]="UnregisterPanel",n[n.ForceRerender=5]="ForceRerender",n))(re||{});let ne={[0](e,t){let r=e.tabs.filter(n=>{var l;return!((l=n.current)!=null&&l.hasAttribute("disabled"))});if(t.index<0)return{...e,selectedIndex:e.tabs.indexOf(r[0])};if(t.index>e.tabs.length)return{...e,selectedIndex:e.tabs.indexOf(r[r.length-1])};let s=e.tabs.slice(0,t.index),d=[...e.tabs.slice(t.index),...s].find(n=>r.includes(n));return d?{...e,selectedIndex:e.tabs.indexOf(d)}:e},[1](e,t){return e.tabs.includes(t.tab)?e:{...e,tabs:Q([...e.tabs,t.tab],r=>r.current)}},[2](e,t){return{...e,tabs:Q(e.tabs.filter(r=>r!==t.tab),r=>r.current)}},[3](e,t){return e.panels.includes(t.panel)?e:{...e,panels:[...e.panels,t.panel]}},[4](e,t){return{...e,panels:e.panels.filter(r=>r!==t.panel)}},[5](e){return{...e}}},N=O(null);N.displayName="TabsSSRContext";function B(e){let t=k(N);if(t===null){let r=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,B),r}return t}let K=O(null);K.displayName="TabsDataContext";function C(e){let t=k(K);if(t===null){let r=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,C),r}return t}let $=O(null);$.displayName="TabsActionsContext";function z(e){let t=k($);if(t===null){let r=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,z),r}return t}function ae(e,t){return J(t.type,ne,e,t)}let le=Y,oe=v(function(t,r){let{defaultIndex:s=0,vertical:b=!1,manual:d=!1,onChange:n,selectedIndex:l=null,...P}=t;const u=b?"vertical":"horizontal",y=d?"manual":"auto";let c=F(r),[p,o]=Z(ae,{selectedIndex:l!=null?l:s,tabs:[],panels:[]}),T=E(()=>({selectedIndex:p.selectedIndex}),[p.selectedIndex]),g=W(n||(()=>{})),L=W(p.tabs),x=E(()=>({orientation:u,activation:y,...p}),[u,y,p]),R=W(p.selectedIndex),h=E(()=>({registerTab(i){return o({type:1,tab:i}),()=>o({type:2,tab:i})},registerPanel(i){return o({type:3,panel:i}),()=>o({type:4,panel:i})},forceRerender(){o({type:5})},change(i){R.current!==i&&g.current(i),R.current=i,o({type:0,index:i})}}),[o]);j(()=>{o({type:0,index:l!=null?l:s})},[l]);let H=G({tabs:[],panels:[]}),w={ref:c};return _.createElement(N.Provider,{value:H},_.createElement($.Provider,{value:h},_.createElement(K.Provider,{value:x},x.tabs.length<=0&&_.createElement(te,{onFocus:()=>{var i,I;for(let M of L.current)if(((i=M.current)==null?void 0:i.tabIndex)===0)return(I=M.current)==null||I.focus(),!0;return!1}}),D({ourProps:w,theirProps:P,slot:T,defaultTag:le,name:"Tabs"}))))}),se="div",ie=v(function(t,r){let{orientation:s,selectedIndex:b}=C("Tab.List"),d=F(r);return D({ourProps:{ref:d,role:"tablist","aria-orientation":s},theirProps:t,slot:{selectedIndex:b},defaultTag:se,name:"Tabs.List"})}),ue="button",ce=v(function(t,r){var I,M;let s=`headlessui-tabs-tab-${q()}`,{orientation:b,activation:d,selectedIndex:n,tabs:l,panels:P}=C("Tab"),u=z("Tab"),y=B("Tab"),c=G(null),p=F(c,r,a=>{!a||u.forceRerender()});j(()=>u.registerTab(c),[u,c]);let o=y.current.tabs.indexOf(s);o===-1&&(o=y.current.tabs.push(s)-1);let T=l.indexOf(c);T===-1&&(T=o);let g=T===n,L=U(a=>{let A=l.map(X=>X.current).filter(Boolean);if(a.key===f.Space||a.key===f.Enter){a.preventDefault(),a.stopPropagation(),u.change(T);return}switch(a.key){case f.Home:case f.PageUp:return a.preventDefault(),a.stopPropagation(),S(A,m.First);case f.End:case f.PageDown:return a.preventDefault(),a.stopPropagation(),S(A,m.Last)}return J(b,{vertical(){if(a.key===f.ArrowUp)return S(A,m.Previous|m.WrapAround);if(a.key===f.ArrowDown)return S(A,m.Next|m.WrapAround)},horizontal(){if(a.key===f.ArrowLeft)return S(A,m.Previous|m.WrapAround);if(a.key===f.ArrowRight)return S(A,m.Next|m.WrapAround)}})}),x=U(()=>{var a;(a=c.current)==null||a.focus()}),R=U(()=>{var a;(a=c.current)==null||a.focus(),u.change(T)}),h=U(a=>{a.preventDefault()}),H=E(()=>({selected:g}),[g]),w=t,i={ref:p,onKeyDown:L,onFocus:d==="manual"?x:R,onMouseDown:h,onClick:R,id:s,role:"tab",type:ee(t,c),"aria-controls":(M=(I=P[T])==null?void 0:I.current)==null?void 0:M.id,"aria-selected":g,tabIndex:g?0:-1};return D({ourProps:i,theirProps:w,slot:H,defaultTag:ue,name:"Tabs.Tab"})}),pe="div",de=v(function(t,r){let{selectedIndex:s}=C("Tab.Panels"),b=F(r),d=E(()=>({selectedIndex:s}),[s]);return D({ourProps:{ref:b},theirProps:t,slot:d,defaultTag:pe,name:"Tabs.Panels"})}),be="div",Te=V.RenderStrategy|V.Static,fe=v(function(t,r){var x,R;let{selectedIndex:s,tabs:b,panels:d}=C("Tab.Panel"),n=z("Tab.Panel"),l=B("Tab.Panel"),P=`headlessui-tabs-panel-${q()}`,u=G(null),y=F(u,r,h=>{!h||n.forceRerender()});j(()=>n.registerPanel(u),[n,u]);let c=l.current.panels.indexOf(P);c===-1&&(c=l.current.panels.push(P)-1);let p=d.indexOf(u);p===-1&&(p=c);let o=p===s,T=E(()=>({selected:o}),[o]),g=t,L={ref:y,id:P,role:"tabpanel","aria-labelledby":(R=(x=b[p])==null?void 0:x.current)==null?void 0:R.id,tabIndex:o?0:-1};return D({ourProps:L,theirProps:g,slot:T,defaultTag:be,features:Te,visible:o,name:"Tabs.Panel"})}),we=Object.assign(ce,{Group:oe,List:ie,Panels:de,Panel:fe});export{we as Tab};
